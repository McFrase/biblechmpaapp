name: Generate Flutter lockfile (2.10.5)

on:
  workflow_dispatch: {}   # run manually from the Actions tab

permissions:
  contents: write
  pull-requests: write

jobs:
  lock:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Set up Flutter 2.10.5
      # v2 action supports pinned Flutter versions
        uses: subosito/flutter-action@v2
        with:
          flutter-version: '2.10.5'
          cache: true

      - name: Generate lockfile
        run: |
          flutter --version
          flutter clean
          rm -f pubspec.lock
          flutter pub get

      # Open a PR with the generated pubspec.lock
      - name: Create Pull Request with lockfile
        uses: peter-evans/create-pull-request@v6
        with:
          token: ${{ secrets.GH_PAT }}   # <-- use the secret
          commit-message: "chore: add pubspec.lock (Flutter 2.10.5)"
          branch: chore/lockfile-flutter-2-10-5
          title: "chore: add pubspec.lock (Flutter 2.10.5)"
          body: |
            Adds pubspec.lock generated with Flutter 2.10.5 so Codemagic can enforce it.
          add-paths: |
            pubspec.lock
